<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Halaman Pelaporan</title>
  <!-- Link ke Google Fonts Inter (untuk konsistensi) -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="../css/global.css">
  <!-- CSS Umum -->
  <link rel="stylesheet" href="../css/home.css"/>
  <!-- CSS Spesifik Pelaporan (termasuk navbar baru) -->
  <link rel="stylesheet" href="../css/pelaporan.css"> 
  <!-- Bootstrap CSS untuk form responsif -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Icon website -->
  <link rel="icon" type="image/x-icon" href="/Assets/img/Icon-OPSI.png">
</head>
<body>

  <!-- Loading overlay dengan wave (navbar baru) -->
  <div id="loading">
    <div class="wave-loader">
      <div class="wave"></div>
      <div class="wave"></div>
      <div class="wave"></div>
    </div>
  </div>

  <!-- Header Navbar Baru (fixed, gradient hijau, active di Pelaporan) -->
  <header id="header">
    <div class="header-left">
      <img src="../Assets/img/CLAVA_no background.png" alt="Logo Aquaclov" />
      <span class="site-title">Aquaclov</span>
    </div>
    <nav class="header-nav">
      <a href="../index.html" class="nav-link">Home</a>
      <a href="../Data/Data.html" class="nav-link">Data</a>
      <a href="../Peta/Peta.html" class="nav-link">Peta</a>
      <a href="../Publikasi/Publikasi.html" class="nav-link">Publikasi</a>
      <a href="../Pelaporan/Pelaporan.html" class="nav-link active">Pelaporan</a>
    </nav>
  </header>

  <!-- Main dan form (dari modifikasi sebelumnya, tetap utuh) -->
  <main style="padding-top: 64px;"> <!-- Padding untuk fixed navbar -->
    <!-- Form Laporan Terintegrasi -->
    <div class="report-container">
      <h2 class="form-header">Sampaikan Laporan Anda</h2>
      
      <form id="complaintForm">
        <!-- Klasifikasi Laporan -->
        <div class="mb-4">
          <label class="form-label">Pilih Klasifikasi Laporan</label>
          <select class="form-select" aria-label="Pilih klasifikasi laporan">
            <option selected disabled>-- Pilih Jenis Laporan --</option>
            <option value="pengaduan">Pengaduan</option>
            <option value="aspirasi">Aspirasi</option>
            <option value="permintaan_informasi">Permintaan Informasi</option>
          </select>
        </div>
        
        <!-- Info Cara Pengaduan -->
        <div class="info-complaint">
          <h6>Perhatikan Cara Menyampaikan Pengaduan Yang Baik dan Benar</h6>
          <p class="mb-0">Pastikan laporan Anda jelas, lengkap, dan disertai bukti yang memadai. Semua informasi akan dijaga kerahasiaannya.</p>
        </div>
        
        <!-- Judul Laporan -->
        <div class="mb-3">
          <label class="form-label required">Ketik Judul Laporan Anda</label>
          <input type="text" class="form-control" placeholder="Contoh: Jalan Rusak di Jl. Merdeka" required>
        </div>
        
        <!-- Isi Laporan -->
        <div class="mb-3">
          <label class="form-label required">Ketik Isi Laporan Anda</label>
          <textarea class="form-control" rows="5" placeholder="Jelaskan secara detail kejadian, kronologi, dan dampak dari permasalahan yang Anda laporkan..." required></textarea>
        </div>
        
        <!-- Tanggal Kejadian -->
        <div class="mb-3">
          <label class="form-label required">Pilih Tanggal Kejadian</label>
          <input type="date" class="form-control" required>
        </div>
        
        <!-- Lokasi Kejadian -->
        <div class="mb-3">
          <label class="form-label required">Ketik Lokasi Kejadian</label>
          <input type="text" class="form-control" placeholder="Contoh: Jl. Merdeka No. 123, Jakarta Pusat" required>
        </div>
        
        <!-- Instansi Tujuan (Statis: BBWS Bengawan Solo) -->
        <div class="mb-4">
          <label class="form-label">Instansi Tujuan</label>
          <p class="instansi-static">BBWS Bengawan Solo</p>
        </div>
        
        <!-- Info Versi -->
        <div class="info-version">
          <p>Laporan ke beberapa Instansi telah beralih ke versi terbaru 4.0. <span class="text-info">info-complaint</span></p>
        </div>
        
        <!-- Upload Lampiran -->
        <div class="mb-4">
          <label class="form-label">Upload Lampiran (0 file terpilih)</label>
          <div class="attachment-container" onclick="document.getElementById('fileUpload').click()">
            <div class="mb-2">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#6c757d" class="bi bi-cloud-arrow-up" viewBox="0 0 16 16">
                <path d="M7.646 5.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708z"/>
                <path d="M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383m.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z"/>
              </svg>
            </div>
            <p class="mb-1">Klik untuk mengunggah lampiran</p>
            <p class="text-muted small">Unggah bukti foto atau dokumen pendukung (maks. 5MB)</p>
            <span id="fileCount">0 file terpilih</span>
          </div>
          <input type="file" id="fileUpload" multiple style="display: none;" onchange="updateFileCount()">
        </div>
        
        <!-- Opsi Privasi (Tanpa Rahasia) -->
        <div class="mb-4">
          <label class="form-label">Opsi Privasi</label>
          <div class="privacy-options">
            <div class="form-check">
              <input class="form-check-input" type="radio" name="privacyOption" id="publicOption" value="umum" checked>
              <label class="form-check-label" for="publicOption">
                Umum
              </label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="privacyOption" id="anonymousOption" value="anonim">
              <label class="form-check-label" for="anonymousOption">
                Anonim
              </label>
            </div>
          </div>
        </div>

        <!-- Kolom Tambahan Kondisional (Nama, Nomor untuk Umum; Penjelasan untuk keduanya) -->
        <div id="additionalFields" style="display: none;">
          <!-- Untuk Umum: Nama dan Nomor -->
          <div class="mb-3 umum-field" style="display: none;">
            <label class="form-label required">Nama Lengkap</label>
            <input type="text" class="form-control" id="namaInput" placeholder="Masukkan nama lengkap Anda">
          </div>
          <div class="mb-3 umum-field" style="display: none;">
            <label class="form-label required">Nomor Telepon</label>
            <input type="text" class="form-control" id="nomorInput" placeholder="Masukkan nomor telepon Anda (contoh: 08123456789)">
          </div>
          
          <!-- Penjelasan untuk Umum dan Anonim -->
          <div class="mb-3">
            <label class="form-label required" id="penjelasanLabel">Penjelasan Tambahan</label>
            <textarea class="form-control" id="penjelasanInput" rows="3" placeholder="Jelaskan lebih lanjut mengenai privasi laporan Anda"></textarea>
          </div>
        </div>
        
        <!-- Tombol Kirim -->
        <button type="submit" class="btn btn-primary btn-submit">Kirim Laporan</button>
      </form>
    </div>
  </main>

  <!-- Footer tetap -->
  <footer>
    <p>&copy; 2025 Sistem Pelaporan Aquaclov. All rights reserved.</p>
  </footer>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- JavaScript Lengkap (Navbar + Form Existing) -->
  <script>
    // Loading fade out (navbar baru)
    window.addEventListener('load', () => {
      const loading = document.getElementById("loading");
      if (loading) {
        loading.style.animation = "fadeOut 2s forwards";
        setTimeout(() => {
          loading.style.display = "none";
        }, 2000);
      }
      initHeaderScroll(); // Navbar scroll
    });

    // Navbar Scroll Efek (dari kode baru, threshold 20px)
    function initHeaderScroll() {
      const header = document.getElementById('header');
      if (!header) return;

      let ticking = false;
      function updateHeader() {
        if (!ticking) {
          requestAnimationFrame(() => {
            const currentScroll = window.scrollY;
            if (currentScroll > 20) {
              header.classList.add('scrolled');
            } else {
              header.classList.remove('scrolled');
            }
            ticking = false;
          });
          ticking = true;
        }
      }
      window.addEventListener('scroll', updateHeader, { passive: true });
      updateHeader(); // Initial
    }

    // File Upload (existing)
    function updateFileCount() {
      const fileInput = document.getElementById('fileUpload');
      const fileCount = document.getElementById('fileCount');
      const uploadLabel = document.querySelector('.mb-4 .form-label');
      fileCount.textContent = fileInput.files.length + ' file terpilih';
      uploadLabel.textContent = 'Upload Lampiran (' + fileInput.files.length + ' file terpilih)';
    }

    // Opsi Privasi Toggle (existing, dengan fix selector untuk .umum-field)
    document.addEventListener('DOMContentLoaded', function() {
      const publicOption = document.getElementById('publicOption');
      const anonymousOption = document.getElementById('anonymousOption');
      const additionalFields = document.getElementById('additionalFields');
      const umumFields = document.querySelectorAll('.umum-field'); // Fixed selector
      const penjelasanInput = document.getElementById('penjelasanInput');
      const penjelasanLabel = document.getElementById('penjelasanLabel');

      function toggleFields() {
        const selectedOption = document.querySelector('input[name="privacyOption"]:checked').value;
        additionalFields.style.display = 'block'; // Selalu tampilkan section

        if (selectedOption === 'umum') {
          umumFields.forEach(field => field.style.display = 'block');
          penjelasanLabel.textContent = 'Penjelasan Tambahan (Umum)';
          penjelasanInput.placeholder = 'Jelaskan lebih lanjut mengenai identitas Anda';
          penjelasanInput.required = false;
          // Tambah required ke nama/nomor
          document.getElementById('namaInput').required = true;
          document.getElementById('nomorInput').required = true;
        } else if (selectedOption === 'anonim') {
          umumFields.forEach(field => field.style.display = 'none');
          penjelasanLabel.textContent = 'Penjelasan Anonim';
          penjelasanInput.placeholder = 'Jelaskan alasan ingin melaporkan secara anonim';
          penjelasanInput.required = true;
          // Hapus required dari nama/nomor
          document.getElementById('namaInput').required = false;
          document.getElementById('nomorInput').required = false;
        }
      }

      publicOption.addEventListener('change', toggleFields);
      anonymousOption.addEventListener('change', toggleFields);
      toggleFields(); // Initial (Umum)
    });

    // Form Submit Validasi (existing, dengan tambahan untuk kolom baru)
    document.getElementById('complaintForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const requiredFields = this.querySelectorAll('[required]');
      let isValid = true;
      
      requiredFields.forEach(field => {
        if (!field.value.trim() && field.style.display !== 'none') { // Skip hidden fields
          field.classList.add('is-invalid');
          isValid = false;
        } else {
          field.classList.remove('is-invalid');
        }
      });
      
      // Validasi khusus untuk umum: nama/nomor jika visible
      const selectedPrivacy = document.querySelector('input[name="privacyOption"]:checked').value;
      if (selectedPrivacy === 'umum') {
        const nama = document.getElementById('namaInput');
        const nomor = document.getElementById('nomorInput');
        if (!nama.value.trim()) { nama.classList.add('is-invalid'); isValid = false; }
        if (!nomor.value.trim()) { nomor.classList.add('is-invalid'); isValid = false; }
      }
      
      if (isValid) {
        alert('Laporan Anda berhasil dikirim! Terima kasih telah melaporkan.');
        this.reset();
        document.getElementById('fileCount').textContent = '0 file terpilih';
        document.querySelector('.mb-4 .form-label').textContent = 'Upload Lampiran (0 file terpilih)';
        document.getElementById('additionalFields').style.display = 'none'; // Reset fields
      } else {
        alert('Harap lengkapi semua field yang wajib diisi!');
      }
    });
  </script>
</body>
</html>